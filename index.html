<!DOCTYPE html>
<html lang="it" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WealthSim Pro - Strategic Planner</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-wrapper">
        <header>
            <div class="logo">Wealth<span>Sim</span></div>
            <div class="theme-switch-wrapper">
                <span id="theme-label">Light Mode</span>
                <label class="theme-switch">
                    <input type="checkbox" id="theme-checkbox" />
                    <div class="slider round"></div>
                </label>
            </div>
        </header>

        <main class="dashboard">
            <aside class="sidebar">
                <div class="mode-selector">
                    <button id="btnModeSim" class="mode-btn active" onclick="switchMode('sim')">Proiezione</button>
                    <button id="btnModeGoal" class="mode-btn" onclick="switchMode('goal')">Obiettivo</button>
                </div>

                <div id="goalSection" class="card goal-card hidden">
                    <h3>üéØ Simulazione Obiettivo</h3>
                    <p class="section-desc">Imposta un traguardo finanziario e lascia che il simulatore calcoli lo sforzo necessario per raggiungerlo.</p>
                    <div class="input-group">
                        <label>Capitale Target Finale (‚Ç¨)</label>
                        <input type="text" id="goalCifra" value="100.000" oninput="formatCurrency(this)">
                    </div>
                    <div class="input-group" style="margin-top:12px;">
                        <label>Parametro da calcolare <span class="info-tag" data-tooltip="Scegli se vuoi scoprire quanto versare ogni mese o che rendimento cercare per arrivare al target.">?</span></label>
                        <select id="goalType">
                            <option value="rate">Versamento Mensile Necessario</option>
                            <option value="yield">Rendimento Annuo Necessario</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <h3>‚öôÔ∏è Parametri Base</h3>
                    <p class="section-desc">Le fondamenta del tuo piano di accumulo.</p>
                    <div class="input-grid">
                        <div class="input-group">
                            <label>Capitale Iniziale (‚Ç¨)</label>
                            <input type="text" id="capitaleIniziale" value="10.000" oninput="formatCurrency(this)">
                        </div>
                        <div class="input-group">
                            <label>Anni Totali</label>
                            <input type="number" id="anni" value="20">
                        </div>
                        <div class="input-group">
                            <label>Versamento Mensile (‚Ç¨)</label>
                            <input type="text" id="versamentoMensile" value="200" oninput="formatCurrency(this)">
                        </div>
                        <div class="input-group">
                            <label>Rendimento % <span class="info-tag" data-tooltip="Il tasso di crescita medio annuo atteso. Esempio: 7% √® una media storica azionaria.">?</span></label>
                            <input type="number" id="tassoAnnuo" value="7">
                        </div>
                    </div>
                    <button id="mainUpdateBtn" class="btn-primary" onclick="triggerCalc()" style="margin-top: 15px; width: 100%;">üîÑ Aggiorna Simulazione</button>
                </div>

                <div id="extraSections">
                    <div class="card advanced-card">
                        <div class="card-header-toggle" onclick="toggleAdvanced()">
                            <h3 style="margin:0;">üöÄ Strategia Avanzata</h3>
                            <span id="advanced-icon">‚ñº</span>
                        </div>
                        <div id="advanced-content" class="hidden" style="margin-top:15px;">
                            <p class="section-desc">Modella il portafoglio su asset reali (Azioni/Obbligazioni).</p>
                            <div class="checkbox-group">
                                <input type="checkbox" id="usaLifeCycle" onchange="toggleLifeCycleUI()">
                                <label for="usaLifeCycle" style="font-weight:700; color:var(--accent);">
                                    Ciclo di Vita <span class="info-tag" data-tooltip="Riduce il rischio (Azioni) man mano che ti avvicini alla fine, proteggendo i profitti. Tassazione calcolata come media ponderata sul mix di asset durante il periodo">?</span>
                                </label>
                            </div>
                            <div class="input-grid" style="margin-top:10px;">
                                <div class="input-group"><label>Resa Az %</label><input type="number" id="rendAzioni" value="8"></div>
                                <div class="input-group"><label>Resa Obb %</label><input type="number" id="rendObb" value="3"></div>
                            </div>
                            <p class="section-sub">Asset Mix (Inizio ‚ûî Fine)</p>
                            <div class="input-grid">
                                <div class="input-group"><label>Az % Start</label><input type="number" id="startAz" value="100" oninput="syncMix('start', 'az')"></div>
                                <div class="input-group"><label>Obb % Start</label><input type="number" id="startObb" value="0" oninput="syncMix('start', 'obb')"></div>
                                <div class="input-group"><label>Az % Fine</label><input type="number" id="endAz" value="40" oninput="syncMix('end', 'az')"></div>
                                <div class="input-group"><label>Obb % Fine</label><input type="number" id="endObb" value="60" oninput="syncMix('end', 'obb')"></div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <h3 style="margin:0;">üìà Variazioni</h3>
                            <button class="btn-icon" onclick="aggiungiVariazione()">+</button>
                        </div>
                        <p class="section-desc">Inserisci l'anno e il nuovo importo mensile (rimarr√† attivo da quell'anno in poi).</p>
                        <div id="listaVariazioni" class="variations-container"></div>
                    </div>
                </div>

                <div class="card">
                    <h3>üè¶ Fisco e Inflazione</h3>
                    <p class="section-desc">Passa dal valore nominale a quello reale (potere d'acquisto).</p>
                    <div class="input-grid">
                        <div class="input-group">
                            <label id="labelTasse">Tasse % <span class="info-tag" data-tooltip="In Italia: 26% su azioni/ETF, 12.5% su Titoli di Stato.">?</span></label>
                            <input type="number" id="tasse" value="26">
                        </div>
                        <div class="input-group">
                            <label>Inflazione % <span class="info-tag" data-tooltip="L'aumento dei prezzi che erode il valore dei soldi. Storicamente intorno al 2%.">?</span></label>
                            <input type="number" id="inflazione" value="2">
                        </div>
                    </div>
                    <div class="checkbox-group" style="margin-top:12px; display:flex; flex-direction:column; gap:8px;">
                        <div><input type="checkbox" id="usaTasse" checked> <label for="usaTasse">Simula Tassazione Netta</label></div>
                        <div>
                            <input type="checkbox" id="usaStressTest"> 
                            <label for="usaStressTest" style="color:var(--fire); font-weight:700;">
                                Monte Carlo Stress Test 
                                <span class="info-tag" data-tooltip="Simula scenari di mercato pessimisti (-3%) e ottimisti (+4%) per darti un range di sicurezza.">?</span>
                            </label>
                        </div>
                    </div>
                </div>
            </aside>

            <section class="main-content" id="report-area">
                <div id="pdf-header-data" class="pdf-only-block" style="display:none;">
                    <h2 style="color:var(--accent); margin-bottom:15px; border-bottom: 2px solid var(--accent); padding-bottom: 10px;">WealthSim Pro - Report Strategico</h2>
                    <div id="pdf-summary-grid" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:15px; margin-bottom:15px; font-size:0.85rem; background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px solid #eee;"></div>
                    <div id="pdf-variations-list" style="margin-bottom:20px; font-size:0.8rem; color:#444; padding-left: 15px;"></div>
                </div>

                <div class="card info-banner" id="infoBanner">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div>
                            <h3 style="margin-top:0;">üìä Benvenuto in WealthSim Pro</h3>
                            <p>Questo strumento ti permette di visualizzare la crescita del tuo patrimonio nel tempo. Puoi simulare <strong>piani di accumulo (PAC)</strong>, gestire il rischio con il <strong>Ciclo di Vita</strong> e vedere come <strong>tasse e inflazione</strong> impattano sulla tua ricchezza reale futura.</p>
                        </div>
                        <button onclick="document.getElementById('infoBanner').style.display='none'" class="close-info">√ó</button>
                    </div>
                </div>

                <div class="top-stats">
                    <div class="stat-card"><small>Lordo Finale</small><h2 id="risultatoLordo">‚Ç¨ 0</h2></div>
                    <div class="stat-card"><small>Netto Tassato</small><h2 id="risultatoNettoTasse">‚Ç¨ 0</h2></div>
                    <div class="stat-card highlight"><small>Valore Reale</small><h2 id="risultatoNettoReale">‚Ç¨ 0</h2><span class="stat-desc">Potere d'acquisto effettivo</span></div>
                    <div class="stat-card fire"><small>Rendita Mensile</small><h2 id="renditaFuoco">‚Ç¨ 0</h2><span class="stat-desc">Prelievo sicuro (4%)</span></div>
                </div>

                <div class="card chart-card">
                    <div class="chart-header-actions" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div class="badge-container" style="position: relative;">
                            <div id="puntoSvoltaBadge" class="badge">--</div>
                            <div class="tooltip-text">‚ú® <strong>Il Punto di Svolta:</strong> Questo √® il momento magico in cui i rendimenti generati dai tuoi soldi superano i tuoi versamenti mensili. Da qui in poi, il capitale lavora pi√π duramente di te!</div>
                        </div>
                        <div class="compare-controls" style="display: flex; align-items: center; gap: 10px;">
                            <div id="compareDelta" class="compare-badge hidden"></div>
                            <button id="btnCompara" class="btn-outline" onclick="toggleComparison()">‚öñÔ∏è Compara Scenari</button>
                            <button id="btnDownloadPDF" class="btn-primary" onclick="downloadPDF()" style="padding: 6px 15px; font-size: 0.75rem;">üì• Scarica Report PDF</button>
                        </div>
                    </div>
                    <div class="chart-container"><canvas id="graficoInteresse"></canvas></div>
                </div>

                <div class="card table-card">
                    <div class="table-scroll">
                        <table id="tabellaRisultati">
                            <thead></thead>
                            <tbody></tbody>
                            <tfoot id="totaleTabella"></tfoot>
                        </table>
                    </div>
                </div>
            </section>
        </main>
    </div> <footer style="margin-top: 40px; padding: 20px; text-align: center; font-size: 0.85rem; color: #64748b; border-top: 1px solid #e2e8f0; background: #f8fafc; border-radius: 8px;">
        <p>&copy; 2026 WealthSim Pro. Tutti i diritti riservati.</p>
        <p style="max-width: 900px; margin: 10px auto; line-height: 1.5;">
            <strong>Disclaimer:</strong> Il simulatore ha scopo puramente illustrativo e non costituisce consulenza finanziaria o sollecitazione al pubblico risparmio. 
            I rendimenti passati non sono garanzia di rendimenti futuri. 
            Le simulazioni si basano su tassi medi stimati e non tengono conto di commissioni bancarie o costi di gestione dei fondi. 
            Effettuare sempre le proprie ricerche o consultare un consulente professionista prima di prendere decisioni di investimento.
        </p>
    </footer>
    <script src="script.js"></script>
</body>
</html>